{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "genui-summarize-block",
  "type": "registry:component",
  "title": "GenUI Summarize Block",
  "description": "GenUI-powered summarize block component with automatic text rewriting and tone customization.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [
    "http://localhost:3000/r/genui-provider.json",
    "tooltip",
    "button",
    "alert",
    "card",
    "skeleton"
  ],
  "files": [
    {
      "path": "registry/new-york/gencn-ui/items/summarize-block/genui-summarize-block.tsx",
      "content": "'use client';\n\nimport * as React from 'react';\nimport type { UseSummarizerOptions, SummarizerOptions, SummarizeOptions } from '@/registry/new-york/gencn-ui/items/shared/genui-types';\nimport { useSummarizer } from '@/registry/new-york/gencn-ui/items/shared/use-genui-summarizer';\nimport { cn } from '@/lib/utils';\nimport { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip';\nimport { Button } from '@/components/ui/button';\nimport { Minimize, Repeat2, Sparkles } from 'lucide-react';\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport type AISummarizerDisplayMode = 'ondemand' | 'static';\n\nexport interface AISummarizerProviderProps extends UseSummarizerOptions {\n  displayMode?: AISummarizerDisplayMode;\n  children: React.ReactNode;\n  joinSeparator?: string;\n  summarizeOptions?: SummarizeOptions;\n}\n\ninterface AISummarizerContextValue {\n  displayMode: AISummarizerDisplayMode;\n  register: (id: string, text: string) => void;\n  update: (id: string, text: string) => void;\n  unregister: (id: string) => void;\n  summarize: () => Promise<void>;\n  show: () => Promise<void>;\n  isLoading: boolean;\n  error: Error | null;\n  progress: number | null;\n  result: string;\n  hasContent: boolean;\n  contentVisible: boolean;\n  setContentVisible: (visible: boolean) => void;\n  hasFreshResult: boolean;\n}\n\nconst AISummarizerContext = React.createContext<AISummarizerContextValue | null>(null);\n\nexport function useAISummarizer() {\n  const ctx = React.useContext(AISummarizerContext);\n  if (!ctx) throw new Error('AISummarizer components must be used within <AISummarizerProvider>');\n  return ctx;\n}\n\nexport function AISummarizerProvider({\n  children,\n  displayMode = 'ondemand',\n  joinSeparator = '\\n\\n',\n  summarizeOptions,\n  ...summarizerOptions\n}: AISummarizerProviderProps) {\n  const registryRef = React.useRef<Map<string, string>>(new Map());\n  const [version, setVersion] = React.useState(0);\n  const [contentVisible, setContentVisible] = React.useState<boolean>(() => (displayMode === 'static'));\n  const timerRef = React.useRef<ReturnType<typeof setTimeout> | null>(null);\n  const lastSummarizedTextRef = React.useRef<string>('');\n\n  const { isLoading, error, progress, result, run, reset } = useSummarizer(summarizerOptions);\n\n  const register = React.useCallback((id: string, text: string) => {\n    registryRef.current.set(id, text);\n    setVersion((v) => v + 1);\n  }, []);\n\n  const update = React.useCallback((id: string, text: string) => {\n    if (registryRef.current.has(id)) {\n      registryRef.current.set(id, text);\n      setVersion((v) => v + 1);\n    }\n  }, []);\n\n  const unregister = React.useCallback((id: string) => {\n    if (registryRef.current.delete(id)) {\n      setVersion((v) => v + 1);\n    }\n  }, []);\n\n  const joinedText = React.useMemo(() => {\n    return Array.from(registryRef.current.values())\n      .map((t) => (t ?? '').toString())\n      .filter((t) => t.trim().length > 0)\n      .join(joinSeparator);\n  }, [version, joinSeparator]);\n\n  const hasContent = joinedText.trim().length > 0;\n  const hasFreshResult = React.useMemo(() => {\n    return (\n      hasContent &&\n      result.trim().length > 0 &&\n      lastSummarizedTextRef.current.trim() === joinedText.trim()\n    );\n  }, [hasContent, result, joinedText]);\n\n  const summarize = React.useCallback(async () => {\n    if (!hasContent) {\n      return;\n    }\n    await run(joinedText, summarizeOptions);\n    setContentVisible(true);\n    lastSummarizedTextRef.current = joinedText;\n  }, [hasContent, run, joinedText, summarizeOptions]);\n\n  const show = React.useCallback(async () => {\n    if (!hasContent) return;\n    if (!hasFreshResult) {\n      await run(joinedText, summarizeOptions);\n      lastSummarizedTextRef.current = joinedText;\n    }\n    setContentVisible(true);\n  }, [hasContent, hasFreshResult, run, joinedText, summarizeOptions]);\n\n  // In static mode: auto-display and debounce summarization by 5s after text changes\n  React.useEffect(() => {\n    if (displayMode !== 'static') return;\n    setContentVisible(true);\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = null;\n    }\n    if (!hasContent) {\n      reset();\n      return;\n    }\n    // Only summarize if the input text changed since the last successful summarize\n    if (joinedText.trim() === lastSummarizedTextRef.current.trim()) {\n      return;\n    }\n    const textForThisRun = joinedText;\n    timerRef.current = setTimeout(() => {\n      timerRef.current = null;\n      void (async () => {\n        await run(textForThisRun, summarizeOptions);\n        setContentVisible(true);\n        lastSummarizedTextRef.current = textForThisRun;\n      })();\n    }, 5000);\n    return () => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n        timerRef.current = null;\n      }\n    };\n  }, [displayMode, joinedText, hasContent, run, summarizeOptions, reset]);\n\n  const value: AISummarizerContextValue = React.useMemo(\n    () => ({\n      displayMode,\n      register,\n      update,\n      unregister,\n      summarize,\n      show,\n      isLoading,\n      error,\n      progress,\n      result,\n      hasContent,\n      contentVisible,\n      setContentVisible,\n      hasFreshResult,\n    }),\n    [displayMode, register, update, unregister, summarize, show, isLoading, error, progress, result, hasContent, contentVisible, hasFreshResult]\n  );\n\n  return <AISummarizerContext.Provider value={value}>{children}</AISummarizerContext.Provider>;\n}\n\n\nexport interface AISummarizerTextProps {\n    text: string;\n    as?: React.ElementType;\n    className?: string;\n  }\n  \n  export function AISummarizerText({ text, as: Component = 'span', className }: AISummarizerTextProps) {\n    const { register, update, unregister } = useAISummarizer();\n    const idRef = React.useRef<string>('');\n  \n    if (!idRef.current) {\n      idRef.current = Math.random().toString(36).slice(2);\n    }\n  \n    React.useEffect(() => {\n      const id = idRef.current;\n      register(id, text);\n      return () => unregister(id);\n    }, [register, unregister]);\n  \n    React.useEffect(() => {\n      update(idRef.current, text);\n    }, [text, update]);\n  \n    return <Component className={className}>{text}</Component>;\n  }\n  \n  \n\n  export interface GenUISummarizerContentProps {\n    className?: string;\n    buttonText?: string;\n    summarizingText?: string;\n    emptyText?: string;\n    showProgress?: boolean; // deprecated: no progress bar in UI\n    enableContentToggle?: boolean;\n    title?: string;\n  }\n  \n  export function GenUISummarizerContent({\n    className,\n    emptyText = 'Summary will appear here',\n    title = 'Summary',\n  }: GenUISummarizerContentProps) {\n    const { displayMode, summarize, show, isLoading, error, progress, result, hasContent, contentVisible, setContentVisible } = useAISummarizer();\n  \n    const handleToggleOndemand = async () => {\n      if (!contentVisible) {\n        await show();\n      } else {\n        setContentVisible(false);\n      }\n    };\n  \n    const showButton = displayMode === 'ondemand' || displayMode === 'static';\n    const showContentBox = contentVisible;\n  \n    return (\n      <div className={cn('space-y-3 relative', className)}>\n        {displayMode === 'ondemand' && (\n          <div className=\"flex justify-end -mt-2 mb-1\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  type=\"button\"\n                  aria-label={contentVisible ? 'Close' : 'Summarize and open'}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-8 w-8 rounded-md p-0\"\n                  onClick={() => void handleToggleOndemand()}\n                  disabled={isLoading && !contentVisible}\n                >\n                 {contentVisible ? <Minimize className=\"h-4 w-4\" /> : <Sparkles className=\"h-4 w-4\" />}\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>{contentVisible ? 'Close' : 'Summarize and open'}</TooltipContent>\n            </Tooltip>\n          </div>\n        )}\n  \n        {error && (\n          <Alert variant=\"destructive\">\n            <AlertTitle>Error</AlertTitle>\n            <AlertDescription>{error.message}</AlertDescription>\n          </Alert>\n        )}\n  \n        {/* Inline content */}\n        {showContentBox && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between gap-2\">\n                <CardTitle className=\"text-lg font-bold\">{title}</CardTitle>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => void summarize()}\n                      disabled={isLoading || !hasContent}\n                      className=\"inline-flex items-center gap-2\"\n                    >\n                      <Repeat2 className=\"h-4 w-4\" />\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent>Re-summarize</TooltipContent>\n                </Tooltip>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"space-y-3\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-4 w-5/6\" />\n                  <Skeleton className=\"h-4 w-2/3\" />\n                  <Skeleton className=\"h-4 w-4/5\" />\n                </div>\n              ) : result ? (\n                <div className=\"whitespace-pre-wrap\">{result}</div>\n              ) : (\n                <div className=\"text-muted-foreground italic min-h-16\">{emptyText}</div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n  \n      \n      </div>\n    );\n  }\n  \n  \n    ",
      "type": "registry:component"
    }
  ]
}