{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "genui-i18n-text",
  "type": "registry:component",
  "title": "GenUI I18n Text",
  "description": "GenUI-powered i18n text component with automatic text rewriting and tone customization.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [
    "http://localhost:3000/r/genui-provider.json",
    "tooltip",
    "button"
  ],
  "files": [
    {
      "path": "registry/new-york/gencn-ui/i18n/I18nText.tsx",
      "content": "\"use client\";\nimport * as React from \"react\";\nimport { Languages } from \"lucide-react\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { translateOnce } from \"@/registry/new-york/gencn-ui/items/shared/lib/translator\";\nimport { detectLanguages } from \"@/registry/new-york/gencn-ui/items/shared/lib/language-detector\";\nimport { Button } from \"@/components/ui/button\";\n\nexport type I18nTextShowOption = \"inline-auto\" | \"inline-manual\" | \"on-hover\";\n\nexport interface GenUII18nTextProps {\n  text: string;\n  language: string;\n  showOption: I18nTextShowOption;\n}\n\nexport function GenUII18nText({ text, language, showOption }: GenUII18nTextProps) {\n  const [translatedText, setTranslatedText] = React.useState<string | null>(null);\n  const [isShowingTranslated, setIsShowingTranslated] = React.useState<boolean>(showOption === \"inline-auto\");\n  const [isLoading, setIsLoading] = React.useState<boolean>(false);\n  const [error, setError] = React.useState<string | null>(null);\n  const abortRef = React.useRef<AbortController | null>(null);\n\n  React.useEffect(() => {\n    setTranslatedText(null);\n    setIsShowingTranslated(showOption === \"inline-auto\");\n    setError(null);\n    if (abortRef.current) {\n      abortRef.current.abort();\n      abortRef.current = null;\n    }\n  }, [text, language, showOption]);\n\n  const ensureTranslation = React.useCallback(async () => {\n    if (translatedText !== null) return translatedText;\n    setIsLoading(true);\n    setError(null);\n    const controller = new AbortController();\n    abortRef.current = controller;\n    try {\n      let sourceLanguage: string | undefined = undefined;\n      try {\n        const detected = await detectLanguages(text);\n        if (Array.isArray(detected) && detected.length > 0) {\n          sourceLanguage = (detected[0] as any).detectedLanguage as string;\n        }\n      } catch {}\n      const result = await translateOnce(text, { sourceLanguage, targetLanguage: language, signal: controller.signal });\n      setTranslatedText(result);\n      return result;\n    } catch (e) {\n      const msg = (e as Error).message || \"Failed to translate\";\n      setError(msg);\n      return null;\n    } finally {\n      setIsLoading(false);\n      abortRef.current = null;\n    }\n  }, [text, language, translatedText]);\n\n  React.useEffect(() => {\n    if (showOption === \"inline-auto\") {\n      void ensureTranslation().then((res) => {\n        if (res !== null) setIsShowingTranslated(true);\n      });\n    }\n  }, [showOption, ensureTranslation]);\n\n  if (showOption === \"on-hover\") {\n    return (\n      <Tooltip onOpenChange={(open) => { if (open) void ensureTranslation(); }}>\n        <TooltipTrigger asChild>\n          <span className=\"inline-flex items-center cursor-help underline decoration-dashed decoration-1 underline-offset-4\">{text}</span>\n        </TooltipTrigger>\n        <TooltipContent>\n          {error ? `Error: ${error}` : (translatedText ?? (isLoading ? \"Translating…\" : \"\"))}\n        </TooltipContent>\n      </Tooltip>\n    );\n  }\n\n  const content = isShowingTranslated ? (translatedText ?? (isLoading ? \"Translating…\" : text)) : text;\n\n  return (\n    <span className=\"inline-flex items-center\">\n      <span>{content}</span>\n      {showOption === \"inline-manual\" && (\n        <Button\n        variant=\"outline\"\n          aria-label={isShowingTranslated ? \"Show original\" : \"Translate\"}\n          className=\"ml-2 inline-flex h-6 w-6 items-center justify-center rounded-full bg-primary text-primary-foreground text-xs shadow hover:opacity-90 disabled:opacity-60\"\n          onClick={async () => {\n            if (!isShowingTranslated) {\n              const res = await ensureTranslation();\n              if (res !== null) setIsShowingTranslated(true);\n            } else {\n              setIsShowingTranslated(false);\n            }\n          }}\n          disabled={isLoading && !isShowingTranslated}\n        >\n          <Languages className=\"h-4 w-4\" />\n        </Button>\n      )}\n      {error && <span className=\"ml-2 text-xs text-destructive\">{error}</span>}\n    </span>\n  );\n}\n\n\n",
      "type": "registry:component"
    }
  ]
}